# دليل الأمان - Chat App

## الميزات الأمنية المطبقة

### 1. تشفير كلمات المرور
- ✅ استخدام **SHA-256** مع **Salt** عشوائي
- ✅ كل كلمة مرور لها salt فريد
- ✅ كلمات المرور لا تُخزن كنص عادي
- ✅ استخدام **Web Crypto API** (مدمج في المتصفح)

### 2. Rate Limiting (منع الهجمات)
- ✅ حد أقصى 5 محاولات تسجيل دخول كل 15 دقيقة
- ✅ يتم حفظ المحاولات في localStorage
- ✅ رسائل واضحة للمستخدم عند تجاوز الحد

### 3. التحقق من المدخلات (Input Validation)
- ✅ التحقق من صحة اسم المستخدم (3-20 حرف، أرقام وحروف فقط)
- ✅ التحقق من قوة كلمة المرور (8+ أحرف، حرف ورقم على الأقل)
- ✅ تنظيف المدخلات لمنع XSS

### 4. Row Level Security (RLS) في Supabase
- ✅ سياسات محددة للقراءة والكتابة
- ✅ المستخدمون يمكنهم رؤية المستخدمين المتصلين فقط
- ✅ التحقق من صحة البيانات عند التسجيل

### 5. التشفير من طرف لطرف (End-to-End Encryption)
- ✅ استخدام **TweetNaCl** للتشفير
- ✅ كل مستخدم له مفتاح عام وخاص
- ✅ الرسائل مشفرة قبل الإرسال

## خطوات التطبيق

### 1. إعداد قاعدة البيانات الآمنة

قم بتشغيل ملف `supabase_security_setup.sql` في Supabase SQL Editor:

```sql
-- انسخ محتوى supabase_security_setup.sql
-- والصقه في Supabase Dashboard > SQL Editor
-- ثم اضغط Run
```

### 2. التحقق من RLS Policies

في Supabase Dashboard:
1. اذهب إلى **Authentication** > **Policies**
2. تأكد من وجود السياسات التالية:
   - "Users can read online users"
   - "Anyone can register"
   - "Users can update their own status"

### 3. تفعيل Realtime

تأكد من تفعيل Realtime للجدول:
```sql
ALTER PUBLICATION supabase_realtime ADD TABLE users;
```

## نصائح أمنية إضافية

### للمستخدمين:
1. ✅ استخدم كلمات مرور قوية (8+ أحرف، حروف وأرقام)
2. ✅ لا تشارك كلمة المرور مع أحد
3. ✅ سجل الخروج عند الانتهاء

### للمطورين:
1. ⚠️ **لا ترفع ملف `.env` على GitHub** (موجود في `.gitignore`)
2. ⚠️ **راجع RLS policies** بانتظام
3. ⚠️ **راقب محاولات تسجيل الدخول الفاشلة**
4. ⚠️ **فكر في إضافة 2FA** للمستخدمين المهمين

## تحديثات أمنية مستقبلية

### قيد التطوير:
- [ ] إضافة Email Verification
- [ ] إضافة Two-Factor Authentication (2FA)
- [ ] إضافة Session Management محسّن
- [ ] إضافة Audit Logging
- [ ] إضافة CAPTCHA لمنع Bots
- [ ] إضافة IP-based rate limiting

## استكشاف المشاكل الأمنية

### مشكلة: كلمات المرور القديمة لا تعمل
**الحل**: المستخدمون القدامى لديهم كلمات مرور غير مشفرة. يجب عليهم:
1. استخدام "Forgot Password" (إذا كان متاحاً)
2. أو إنشاء حساب جديد

### مشكلة: Rate limiting يمنع المستخدمين الشرعيين
**الحل**: يمكن مسح localStorage:
```javascript
localStorage.clear();
```

### مشكلة: RLS يمنع الوصول
**الحل**: تحقق من:
1. أن RLS policies موجودة ومفعّلة
2. أن Supabase anon key صحيح
3. أن الجدول `users` موجود

## الاتصال بنا

إذا وجدت ثغرة أمنية، يرجى:
1. **لا تشاركها علناً**
2. أبلغ المطور مباشرة
3. امنح وقتاً للإصلاح قبل الإفصاح

---

**آخر تحديث**: تم تطبيق جميع الميزات الأمنية الأساسية ✅
